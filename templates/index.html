<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Student Interaction Chatbot</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
  <div class="main-layout">
    <!-- ğŸ§­ Sidebar -->
    <div class="sidebar">
      <h2>ğŸ“š ECE Portal</h2>
      <button onclick="quickAsk('faculty details')">ğŸ§‘â€ğŸ« Faculty</button>
      <button onclick="quickAsk('lab details')">ğŸ”¬ Labs</button>
      <button onclick="quickAsk('department info')">ğŸ›ï¸ Department</button>
      <button onclick="quickAsk('club events')">ğŸ‰ Club Events</button>
      <button onclick="quickAsk('latest notifications')">ğŸ“° Notifications</button>
    </div>

    <!-- ğŸ’¬ Chat Container -->
    <div class="container">
      <div class="header">
  <h2>ğŸ“ Student Interaction Chatbot</h2>
  <h3>Department of ECE</h3>
  <p>V.S.B. Engineering College, Karur</p>
  <p class="tagline">Ask me anything about your department!</p>
</div>


      <div class="chatbox" id="chatbox"></div>

      <div class="typing-indicator" id="typingIndicator">ğŸ’¬ Bot is replying...</div>

      <div class="input-area">
        <input type="text" id="userInput" placeholder="Type your question here..." onkeypress="if(event.key==='Enter'){sendMessage();}">
        <button onclick="sendMessage()">Send</button>
      </div>
    </div>
  </div>

  <script>
    // âœ… Show dynamic greeting message based on time
    window.onload = function() {
      let chatbox = document.getElementById("chatbox");
      let currentHour = new Date().getHours();
      let greeting = "";

      if (currentHour < 12) {
        greeting = "â˜€ï¸ Good Morning, Student!";
      } else if (currentHour < 18) {
        greeting = "ğŸŒ¤ï¸ Good Afternoon, Student!";
      } else {
        greeting = "ğŸŒ™ Good Evening, Student!";
      }

      chatbox.innerHTML = `<div class='botMsg'>${greeting}<br>I'm your ECE Assistant. How can I help you today?</div>`;
    };

    const chatbox = document.getElementById("chatbox");
    const typingIndicator = document.getElementById("typingIndicator");

    function sendMessage() {
      let userInput = document.getElementById("userInput").value.trim();
      if (userInput === "") return;

      chatbox.innerHTML += `<div class='userMsg'>${userInput}</div>`;
      typingIndicator.style.display = "block";

      fetch("/get", {
        method: "POST",
        body: new URLSearchParams({ msg: userInput }),
        headers: { "Content-Type": "application/x-www-form-urlencoded" },
      })
      .then(res => res.json())
      .then(data => {
        setTimeout(() => {
          typingIndicator.style.display = "none";
          chatbox.innerHTML += `<div class='botMsg'>${data.reply}</div>`;
          chatbox.scrollTop = chatbox.scrollHeight;
        }, 1000);
      })
      .catch(() => {
        typingIndicator.style.display = "none";
        chatbox.innerHTML += `<div class='botMsg error'>âš ï¸ Server error. Please try again later.</div>`;
      });

      document.getElementById("userInput").value = "";
      chatbox.scrollTop = chatbox.scrollHeight;
    }

    function quickAsk(question) {
      document.getElementById("userInput").value = question;
      sendMessage();
    }
  </script>
</body>
</html>
